<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title></title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="//maxcdn.bootstrapcdn.com/bootswatch/3.3.2/yeti/bootstrap.min.css" rel="stylesheet" type="text/css"/>
        <link href="//gitcdn.github.io/bootstrap-toggle/2.1.0/css/bootstrap-toggle.min.css" rel="stylesheet" type="text/css"/>

        <style type="text/css">
            .tt{
                display:none;
                margin:4px;
                padding:4px;
                border:1px solid darkgrey;
                background-color:lightgrey;
                position: absolute;
                z-index: 5;
            }
            #bed, z{
                cursor:crosshair;
            }
        </style>
    </head>
    <body>
        <div class="tt"></div>
        <div class="container-fluid">
            <div class="row">
                <div class="col-xs-2 col-xs-offset-1">
                    <div id="z" style="margin-top:5px; width:50px; height:200px; border: 10px grey solid"></div>
                </div>
                <div class="col-xs-9">
                    <div id="bed" style="margin-top:5px; width:260px; height:200px; border: 10px grey solid"></div>
                </div>
                <div class="col-xs-8" style="margin-top: 8px;">
                    <div class="input-group">
                        <input type="text" id="gcode" class="form-control" placeholder="G Code">    
                        <span class="input-group-btn">
                            <button class="btn btn-default" type="button">Send</button>
                        </span>
                    </div>  
                </div>

                <div class="col-xs-4" style="margin-top: 8px;">
                    <input type="checkbox" id="autosend" checked data-toggle="toggle">
                </div>
            </div>
        </div>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="//gitcdn.github.io/bootstrap-toggle/2.1.0/js/bootstrap-toggle.min.js" type="text/javascript"></script>
        <script>
            var xmax = 200, xmin = -15, ymax = 200, ymin = 0, zmax = 200, zmin = 0;
            var yzero = ymax, xzero = xmin, zzero = zmax;

            /**
             * Bed Click, position, tooltip
             */
            $('#bed').on('mousemove', function (e) {
                //browser y = ormerod x
                var pos = mousePos('#bed', e.pageY, e.pageX);
                tooltip('X:' + pos.x + ',Y:' + pos.y, e.pageX, e.pageY)
            }).on('click', function (e) {
                var pos = mousePos('#bed', e.pageY, e.pageX);
                $('#gcode').val('G1 X' + pos.x + ' Y' + pos.y);
            }).on('mouseleave', function () {
                tooltip();
            });

            $('#z').on('mousemove', function (e) {
                var pos = mousePos('#z', '', '', e.pageY);
                tooltip('Z:' + pos.z, e.pageX, e.pageY)
            }).on('click', function (e) {
                var pos = mousePos('#z', '', '', e.pageY);
                $('#gcode').val('G1 Z' + pos.z);
            });

            $('#autosend').bootstrapToggle({
                on: 'AutoSend On',
                off: 'AutoSend Off'
            });

            function tooltip(content, x, y) {
                if (content) {
                    $('.tt').show();
                    $('.tt').css({top: y + "px", left: x + "px"}).text(content);
                } else {
                    $('.tt').hide();
                }
            }

            function mousePos(element, x, y, z) {
                var xx, yy, zz;
                var off = $(element);
                if (x) {
                    xx = Math.floor((x - off.offset().top) / (off.outerHeight() / (xmax - xmin))) - 15;
                    xx < xmin ? xx = xmin : false;
                    xx > xmax ? xx = xmax : false;
                }
                if (y) {
                    yy = Math.floor((y - off.offset().left) / (off.outerWidth() / (ymax - ymin)));
                    yy < ymin ? yy = ymin : false;
                    yy > ymax ? yy = ymax : false;
                }
                if (z) {
                    zz = Math.floor((z - off.offset().top) / (off.outerHeight() / (zmax - zmin)));
                    zz < zmin ? zz = zmin : false;
                    zz > zmax ? zz = zmax : false;
                }

                return {x: xx, y: yzero - yy, z: zzero - zz};
            }
        </script>        
    </body>
</html>
